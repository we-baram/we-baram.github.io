<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>우리의 바람</title>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
      rel="stylesheet"
      integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH"
      crossorigin="anonymous"
    />
    <link href="/css/main.css" rel="stylesheet" />
    <style>
      .table-responsive thead tr {
        background-color: #767676;
        color: #fff;
      }
    </style>
  </head>
  <body>
    <div id="wrap">
      <div class="row mt-5">
        <div class="col-12">
          <div class="card">
            <div class="card-body">
              <h4 class="card-title">공지사항</h4>
              <!--                    <h6 class="card-subtitle mb-10px text-muted">Card subtitle</h6>-->
              <p class="card-text">신규환수 제보해주시면 감사하겠습니다.</p>
              <a href="javascript:;" class="card-link">오픈톡</a>
              <a href="javascript:;" class="card-link">안내사항</a>
            </div>
          </div>
        </div>
      </div>

      <div class="row mt-3">
        <div class="col-12">
          <div class="card">
            <div class="card-body">
              <h4 class="card-title">환수정보</h4>
              <div class="mt-3">
                <div class="btn btn-primary btn-sm guardBtn">수호</div>
                <div class="btn btn-primary btn-sm ms-2 changeBtn">변신</div>
              </div>
              <div class="mt-3">
                <div id="" class=""></div>
              </div>
              <div class="mt-3">선택된 환수 : 0/40</div>
              <div class="mt-3">
                <div class="btn btn-danger guardBtn">초기화</div>
                <div class="btn btn-success ms-2 changeBtn">계산하기</div>
              </div>
            </div>
          </div>
        </div>
      </div>
      <div class="row mt-3">
        <div class="col-12 col-lg-6">
          <div class="card">
            <div class="card-body">
              <h4 class="card-title">환수 성장 경험치 표</h4>
              <div class="mt-3">
                <div class="btn btn-danger btn-sm growthBtn" data-unit="1">
                  전설 환수
                </div>
                <div
                  class="btn btn-warning btn-sm ms-2 growthBtn"
                  data-unit="3"
                >
                  불멸 환수
                </div>
              </div>
              <div class="mt-3">
                <div class="table-responsive">
                  <table class="table table-bordered mb-0 growthTable">
                    <thead>
                      <tr>
                        <th>레벨</th>
                        <th>필요 경험치</th>
                        <th>레벨</th>
                        <th>필요 경험치</th>
                      </tr>
                    </thead>
                    <tbody>
                      <tr>
                        <td>1</td>
                        <td class="figureTxt" data-num="717">717</td>
                        <td>14</td>
                        <td class="figureTxt" data-num="9484">9,484</td>
                      </tr>
                      <tr>
                        <td>2</td>
                        <td class="figureTxt" data-num="789">789</td>
                        <td>15</td>
                        <td class="figureTxt" data-num="10433">10,433</td>
                      </tr>
                      <tr>
                        <td>3</td>
                        <td class="figureTxt" data-num="867">867</td>
                        <td>16</td>
                        <td class="figureTxt" data-num="11476">11,476</td>
                      </tr>
                      <tr>
                        <td>4</td>
                        <td class="figureTxt" data-num="1302">1,302</td>
                        <td>17</td>
                        <td class="figureTxt" data-num="17214">17,214</td>
                      </tr>
                      <tr>
                        <td>5</td>
                        <td class="figureTxt" data-num="1431">1,431</td>
                        <td>18</td>
                        <td class="figureTxt" data-num="18935">18,935</td>
                      </tr>
                      <tr>
                        <td>6</td>
                        <td class="figureTxt" data-num="1575">1,575</td>
                        <td>19</td>
                        <td class="figureTxt" data-num="28403">28,403</td>
                      </tr>
                      <tr>
                        <td>7</td>
                        <td class="figureTxt" data-num="1732">1,732</td>
                        <td>20</td>
                        <td class="figureTxt" data-num="31243">31,243</td>
                      </tr>
                      <tr>
                        <td>8</td>
                        <td class="figureTxt" data-num="1905">1,905</td>
                        <td>21</td>
                        <td class="figureTxt" data-num="31868">31,868</td>
                      </tr>
                      <tr>
                        <td>9</td>
                        <td class="figureTxt" data-num="3239">3,239</td>
                        <td>22</td>
                        <td class="figureTxt" data-num="32505">32,505</td>
                      </tr>
                      <tr>
                        <td>10</td>
                        <td class="figureTxt" data-num="3563">3,563</td>
                        <td>23</td>
                        <td class="figureTxt" data-num="33155">33,155</td>
                      </tr>
                      <tr>
                        <td>11</td>
                        <td class="figureTxt" data-num="3919">3,919</td>
                        <td>24</td>
                        <td class="figureTxt" data-num="33828">33,818</td>
                      </tr>
                      <tr>
                        <td>12</td>
                        <td class="figureTxt" data-num="4312">4,312</td>
                        <td>25</td>
                        <td class="figureTxt" data-num="34494">34,494</td>
                      </tr>
                      <tr>
                        <td>13</td>
                        <td class="figureTxt" data-num="4742">4,742</td>
                        <td></td>
                        <td></td>
                      </tr>
                    </tbody>
                  </table>
                </div>
              </div>
            </div>
          </div>
        </div>
        <div class="col-12 col-lg-6">
          <div class="card">
            <div class="card-body">
              <h4 class="card-title">환수혼 계산기</h4>
              <div class="mt-3">
                <form>
                  <div class="row">
                    <div class="col-12 selectmenu-custom">
                      <div class="form-floating w-100">
                        <select id="calSel" class="form-control">
                          <option value="1" selected data-unit="1">전설</option>
                          <option value="2" data-unit="3">불멸</option>
                        </select>
                        <label
                          for="calSel"
                          class="d-flex align-items-center fs-13px"
                        >
                          등급
                        </label>
                      </div>
                    </div>
                  </div>
                  <div class="row mt-3">
                    <div class="col-6">
                      <div class="form-floating mb-3 mb-md-0">
                        <input
                          type="number"
                          class="form-control fs-15px"
                          value="0"
                          id="currentLevel"
                          min="0"
                          max="24"
                        />
                        <label
                          for="currentLevel"
                          class="d-flex align-items-center fs-13px"
                        >
                          현재 레벨(0)
                        </label>
                      </div>
                    </div>
                    <div class="col-6">
                      <div class="form-floating mb-3 mb-md-0">
                        <input
                          type="number"
                          class="form-control fs-15px"
                          value="25"
                          id="targetLevel"
                          min="1"
                          max="25"
                        />
                        <label
                          for="targetLevel"
                          class="d-flex align-items-center fs-13px"
                        >
                          목표 레벨(25)
                        </label>
                      </div>
                    </div>
                  </div>

                  <div class="row mt-3">
                    <h5 class="card-title">현재 보유한 환수의 혼</h5>
                    <div class="col-4">
                      <div class="form-floating mb-3 mb-md-0">
                        <input
                          type="number"
                          class="form-control fs-15px"
                          id="lowerLevel"
                          value="0"
                          min="0"
                          max="50000"
                        />
                        <label
                          for="lowerLevel"
                          class="d-flex align-items-center fs-13px"
                        >
                          하급 혼
                        </label>
                        <img
                          src="/assets/img/lower_growth.jpg"
                          class="rounded-circle"
                          style="
                            position: absolute;
                            right: 5px;
                            top: 50%;
                            transform: translateY(-50%);
                            border: 0;
                            background: none;
                            font-size: 1rem;
                            width: 40px;
                            pointer-events: none;
                          "
                        />
                      </div>
                    </div>
                    <div class="col-4">
                      <div class="form-floating mb-3 mb-md-0">
                        <input
                          type="number"
                          class="form-control fs-15px"
                          id="middleLevel"
                          value="0"
                          min="0"
                          max="50000"
                        />
                        <label
                          for="middleLevel"
                          class="d-flex align-items-center fs-13px"
                        >
                          상급 혼
                        </label>
                        <img
                          src="/assets/img/middle_growth.jpg"
                          class="rounded-circle"
                          style="
                            position: absolute;
                            right: 5px;
                            top: 50%;
                            transform: translateY(-50%);
                            border: 0;
                            background: none;
                            font-size: 1rem;
                            width: 40px;
                            pointer-events: none;
                          "
                        />
                      </div>
                    </div>
                    <div class="col-4">
                      <div class="form-floating mb-3 mb-md-0">
                        <input
                          type="number"
                          class="form-control fs-15px"
                          id="upperLevel"
                          value="0"
                          min="0"
                          max="50000"
                        />
                        <label
                          for="upperLevel"
                          class="d-flex align-items-center fs-13px"
                        >
                          최상급 혼
                        </label>
                        <img
                          src="/assets/img/upper_growth.jpg"
                          class="rounded-circle"
                          style="
                            position: absolute;
                            right: 5px;
                            top: 50%;
                            transform: translateY(-50%);
                            border: 0;
                            background: none;
                            font-size: 1rem;
                            width: 40px;
                            pointer-events: none;
                          "
                        />
                      </div>
                    </div>
                  </div>
                </form>
                <div class="mt-3 text-center">
                  <div class="btn btn-block btn-success ms-2 calculateBtn">
                    필요 경험치 및 환수혼 계산
                  </div>
                </div>
                <div
                  class="alert alert-secondary mt-3 resultDiv"
                  role="alert"
                  style="display: none"
                >
                  <div class="p-2">
                    <div id="calResultDiv"></div>
                    <div id="resultMessage" class="mt-3"></div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
    <script
      src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"
      integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz"
      crossorigin="anonymous"
    ></script>
    <script>
      $(document).ready(function () {
        $(".growthBtn").click(function () {
          let unit = $(this).data("unit");

          $(".growthTable .figureTxt").each(function () {
            let num = parseInt($(this).data("num"));
            $(this).text((num * unit).toLocaleString());
          });
        });

        let selUnit = 1;
        $("#calSel").change(function () {
          selUnit = $(this).find(":selected").data("unit");
          console.log(selUnit);
        });

        $(".calculateBtn").click(function () {
          var expTable = [
            717, 789, 867, 1302, 1431, 1575, 1732, 1905, 3239, 3563, 3919, 4312,
            4742, 9484, 10433, 11476, 17214, 18935, 28403, 31243, 31868, 32505,
            33155, 33818, 34494,
          ];

          var currentLevel = parseInt($("#currentLevel").val());
          var targetLevel = parseInt($("#targetLevel").val());
          var lowerLevel = parseInt($("#lowerLevel").val());
          var middleLevel = parseInt($("#middleLevel").val());
          var upperLevel = parseInt($("#upperLevel").val());

          if (
            isNaN(currentLevel) ||
            isNaN(targetLevel) ||
            currentLevel < 0 ||
            targetLevel > 25 ||
            currentLevel >= targetLevel
          ) {
            alert("올바른 레벨 범위를 입력하세요! (현재 레벨 < 목표 레벨)");
            return;
          }

          var totalExp = 0;
          for (var i = currentLevel; i < targetLevel; i++) {
            totalExp += expTable[i] * selUnit; // 배열은 0부터 시작
          }

          $(".resultDiv").show();

          let html = `총 ${totalExp.toLocaleString()} 경험치 필요합니다`;
          $("#calResultDiv").html(html); // 천 단위 콤마 추가

          // 사용자가 입력한 환수의 혼을 경험치로 변환
          var lowerExp = lowerLevel * 10;
          var middleExp = middleLevel * 100;
          var upperExp = upperLevel * 1000;
          var totalOwnedExp = lowerExp + middleExp + upperExp;

          var message = `
                    <h5 class="title">입력한 환수의 혼</h5>
                    <div class="d-flex justify-content-start align-items-center">
                        <div>
                             <img alt="" src="/assets/img/lower_growth.jpg" class="rounded-circle" style="width:50px; height:50px;">
                        </div>
                        <div class="ms-2">
                            <div class="title">하급 : ${lowerLevel.toLocaleString()}</div>
                            <div class="desc">성장 경험치 : 10</div>
                        </div>
                        <div class="ms-3">
                            <b class="h5">${lowerExp.toLocaleString()}</b>
                        </div>
                    </div>
                    <div class="d-flex justify-content-start align-items-center mt-2">
                        <div>
                             <img alt="" src="/assets/img/middle_growth.jpg" class="rounded-circle" style="width:50px; height:50px;">
                        </div>
                        <div class="ms-2">
                            <div class="title">상급 : ${middleLevel.toLocaleString()}</div>
                            <div class="desc">성장 경험치 : 100</div>
                        </div>
                        <div class="ms-3">
                            <b class="h5">${middleExp.toLocaleString()}</b>
                        </div>
                    </div>
                    <div class="d-flex justify-content-start align-items-center mt-2">
                        <div>
                             <img alt="" src="/assets/img/upper_growth.jpg" class="rounded-circle" style="width:50px; height:50px;">
                        </div>
                        <div class="ms-2">
                            <div class="title">최상급 : ${upperLevel.toLocaleString()}</div>
                            <div class="desc">성장 경험치 : 1,000</div>
                        </div>
                        <div class="ms-3">
                            <b class="h5">${upperExp.toLocaleString()}</b>
                        </div>
                    </div>
                `;

          // 필요 경험치와 보유한 경험치를 비교
          if (totalOwnedExp >= totalExp) {
            message += `
                    <div class="mt-3">
                        <strong class="text-success">충분합니다</strong>
                    </div>`;
          } else {
            var lackingExp = totalExp - totalOwnedExp;
            message += `
                    <div class="mt-3">
                        <strong class="text-danger">${lackingExp.toLocaleString()} 경험치 부족합니다</strong>
                    </div>`;
          }

          $("#resultMessage").html(message);
        });
        $("input[type='number']").on("input", function () {
          let val = $(this).val();
          let min = $(this).attr("min") ? parseInt($(this).attr("min")) : 0;
          let max = $(this).attr("max")
            ? parseInt($(this).attr("max"))
            : Number.MAX_SAFE_INTEGER;

          // 공백이면 0 설정
          if (val === "") {
            $(this).val(0);
            return;
          }

          // 숫자가 아닌 값 제거 (type="number"라서 사실상 불필요하지만 안전하게 추가)
          val = val.replace(/[^0-9]/g, "");

          // 맨 앞에 0이 있으면 제거 (단, 숫자 0 하나만 입력된 경우 제외)
          val = val.replace(/^0+(\d)/, "$1");

          // 최대값 초과 시 자동으로 max 값으로 변경
          if (parseInt(val) > max) {
            val = max;
          }

          $(this).val(val);
        });
      });
    </script>
  </body>
</html>
